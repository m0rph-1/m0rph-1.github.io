---
layout: single
title: Vulnerability Lifecycle
date: 2019-10-08
classes: wide
tags:
  - General
  - Pentesting
  - InfoSec
  - Bug Hunting
---
I was given the opportunity to talk about the lifecycle of vulnerabilities for a cybersecurity focus group with AITP of the Ozarks. Some of the content was a bit dry, but laying a proper context and talking about legal obligations concerning bug hunting and disclosures is an important part of the process. Overall, I was happy to share some knowledge and experiences, and someday I hope to give a proper disclosure for CVE-2017-12301; however, sharing knowledge of the vulnerability lifecycle can be just as beneficial (if not, moreso in my opinion), especially for those aspiring to get into bug hunting/exploit development. Below you will find the outline I used as the basis of my talk. There was a lot of content to cover in an hour, and I fumbled around a bit with this being my 2nd public speaking event and some of the content I didn't have time to cover. This is pretty ugly in its current format, but part of the fun is doing research on your own. It's my sincerest hope that everyone was able to take something away from the presentation. I truly believe anyone - no matter their life circumstances - can learn how to find bugs and develop exploits for them; however, I also believe very few will ever truly become good at it. This is an obscure area of infosec to get into, but hopefully the talk was able to shed some light on how to go about doing it. More or less, I think the talk was successful despite being given with a browser and notepad - although, it's easy to go on side-rants in any speaking endeavor. On to the outline!

## What are vulnerabilities?
* A vulnerability is a weakness or exposure in a technology, protocol or design of an information technology system such as hardware, firmware and software. (ISC2)
* An exploit is software, a subset of data, or a sequence of commands that takes advantage of a bug or vulnerability to cause unintended or unanticipated behavior to occur (ISC2)

## Background
* 16555 vulnerabilities disclosed in 2018
* 1545 were critical

## Who discovers them?
* Industry Professionals
* Students/Independent Researchers
* Government Entities
* Criminals 

## What are some affected products/services?
* Operating System Kernels
* Web applications
* Server applications
* Protocols
* PBX systems
* IOT
* Healthcare products
* Anything with computational resources

## What are CVEs?
* Public dictionary of known vulnerabilities (not a database)
* A way to uniquely identify and name disclosures in a standardized format
* Facilitate confidence in triage with stakeholders
* CNA (CVE Numbering Authorities)
* Two root CNAs: MITRE, JPCERT/CC
* Typically major vendors are CNAs (i.e. Microsoft, Adobe, Dell, other major developers)
* Any organization can become one
* Overwhelming majority of CVEs are allocated from MITRE
* JPCERT/CC primarily deals with Eastern companies & products

The important thing to note here is if you discover a vulnerability you should send the bug report to the relevant CNA - NOT customer support centers. CNA's will handle the reservation and allocation of a CVE, and coordinate with the appropriate developing party for remediation.

## Legality
* Understand the Terms of Use for products you are testing
* Know in advance if the vendor/developer has a bug reporting program
* Comply with scope if doing a bug bounty program
* Computer Fraud & Abuse Act of 1986
* Easy to land in jail if you're not careful

## Vulnerability Lifecycle
1. #### Discovery ####
    1. Code review/auditing (whitebox testing)
    2. Fuzzing (blackbox testing)
2. #### Testing ####
    1. Anomolies discovered
    2. Error-based feedback
    3. Triage
3. #### Exploitation ####
    1. proof of concept developed (zero-day)
    2. details of vulnerability become a packaged product
4. #### Reporting ####
    1. Positive circumstances (bug report sent to vendor, company, developer, etc)
    2. Negative circumstances (exploit put up for sale on dark web, black market, or kept hidden by government entities)
    3. Lifecycle can branch into two directions depending on who initially discovers the vulnerability
5. #### Response ###
    1. CVE assigned - developer gives patch
    2. No CVE - but developer gives patch/hotfix
    3. No CVE - developer does not patch
    4. Remains zero-day/used/sold on black market
6. #### Disclosure ####
    1. Grace period (exploit disclosed typically 90 days after patching)
    2. No grace period (exploit disclosed immediately)
    3. No grace period (exploit sold on black market)
    4. Challenges (NDA's, intellectual property, vendor acknowledgement, malware)

Giving a grace period to disclose after a patch has been released is one of the most critical times of the vulnerability lifecycle. WannaCry was the perfect example of how this can go wrong. Disclosing exploits is very cool and interesting, but giving the industry time to patch against a vulnerability is of utmost importance for the stability of products and safety of consumers.  

## When are they patched?
* Typically within 3 to 6 months of bug report
* Zero-days have an average life-span of 6.9 years ("Zero Days, Thousands of Nights" - Lillian Ablon, Andy Bogart)

## Tools
* GNU Debugger (GDB)
* x32/x64debug, Immunity Debugger (Ollydbg out of development for 5 years)
* Mona.py (Immunity plugin), PEDA (GDB plugin)
* Radare2, IDA Pro (Disassemblers)
* Browser consoles
* Metasploit Framework (e.g. pattern_offset, pattern_create, nasm_shell)

## Exploit Mitigations
* Address Space Layout Randomization (ASLR)
* DEP/NX-bit (Data Execution Prevention, No-eXecutable bit)
* Stack canaries/cookies (random value integer inserted before stack return pointer)
* SafeSEH/SEHOP (integrity checks for structured exception handler overwrites)
* Null Pointer Dereference Protection
* Isolated Heaps (isolated locations of critical HTML objects)
* Protected Free 
* EAF/EAF+ (Export Address Table Filtering)
* ControlFlowGuard / Return Flow Guard (identifies indirect calls & restricts where they can execute code from)
* Sandboxing

## Windows Defender Exploit Guard & Process Mitigation Management Tool
* Windows Defender Exploit Guard (EMET replacement)
* Get-ProcessMitigation -System (system configurations - can also use Set-ProcessMitigation to change options)
* Attack Surface Reduction (more on this later in WebApp)
* Network protection (blocks outbound-processes)
* Controlled folder access (real-time alerting and blocking on access or modification)

## Mitigations (Web/App)
* Attack Surface Reduction (Windows Defender Exploit Guard feature: disabling of embedded objects, Office, script, and e-mail-based threats)
* PDO::prepare() / prepared statements (dynamically built-in sanitization of queries and statements)
* Security Headers (HSTS, HPKP, X-Content-Type-Options, X-Frame-Options, X-XSS-Protection)
* Web Application Firewalls (WAF)
* Containers (Docker, Kubernetes can provide an additional layer of segmentation between applications and their hosts)
* Filtering (static & undesirable)

## Exploit Development Goals

1. Audit code or fuzz for bugs (systematically enumerate ways to escape inputs)
2. Redirect code flow to controllable circumstances
3. Continue trial and error until a proof of concept is made
4. Bypass mitigations (getting better as time goes on)
5. Know your target platform
6. Design exploit to be as dynamic as possible

## Lessons Learned
* Encourage people to test products
* Have a responsible disclosure policy
* Send bug reports to a CNA, not customer support
* Mitre can help broker disclosures if you don't know who to send a bug report to
* Foster vendor/client relations to give lasting value
* Design applications for compatibility with mitigation technologies
* Have a plan (legal-wise, proof-of-concept, working with vendor, post-advisory patching)

## Resources
+   [Mitre CVE Listings](https://cve.mitre.org)
+   [CVE Details](https://cvedetails.com)
+   [National Vulnerability Database](https://nvd.nist.gov)
+   [Hack The Box](https://hackthebox.eu)
+   [VulnHub](https://vulnhub.com)
+   [VulnServer](http://www.thegreycorner.com/p/vulnserver.html)
+   [HackerOne](https://hackerone.com)
+   [Zero Days, Thousands of Nights](https://www.rand.org/pubs/research_reports/RR1751.html)
